<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greek Reader - Shepherd Suite</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=GFS+Didot&family=Noto+Serif:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            color-scheme: dark;
            --background: #0f1115;
            --foreground: #f5f7fa;
            --card: rgba(24, 27, 33, 0.75);
            --card-foreground: #f5f7fa;
            --primary: #20d4d4;
            --primary-foreground: #041c1c;
            --secondary: rgba(34, 38, 45, 0.85);
            --muted: rgba(29, 32, 38, 0.7);
            --muted-foreground: #94a3b8;
            --accent: rgba(32, 212, 212, 0.12);
            --border: rgba(255, 255, 255, 0.08);
            --input: rgba(255, 255, 255, 0.08);
            --radius: 0.75rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--background);
            color: var(--foreground);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(15, 17, 21, 0.95);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            padding: 1rem 2rem;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
            letter-spacing: -0.02em;
        }

        .reference-picker {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .picker-label {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.32em;
            color: rgba(148, 163, 184, 0.7);
        }

        select {
            background: rgba(34, 38, 45, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: calc(var(--radius) - 0.25rem);
            color: var(--foreground);
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        select:hover {
            border-color: rgba(32, 212, 212, 0.4);
        }

        select:focus {
            outline: 2px solid rgba(32, 212, 212, 0.6);
            outline-offset: 2px;
            border-color: var(--primary);
        }

        /* Translation Tabs */
        .translation-tabs {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: rgba(34, 38, 45, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 9999px;
            padding: 0.25rem;
        }

        .tab-btn {
            background: transparent;
            border: none;
            color: var(--muted-foreground);
            padding: 0.375rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            min-width: 64px;
        }

        .tab-btn:hover {
            color: var(--foreground);
        }

        .tab-btn.active {
            background: var(--primary);
            color: var(--primary-foreground);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Main Layout */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0;
            min-height: calc(100vh - 80px);
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: transparent;
            padding: 2rem 2.5rem;
            overflow-y: auto;
            height: calc(100vh - 80px);
        }

        .panel:first-child {
            border-right: 1px solid rgba(255, 255, 255, 0.08);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        }

        .panel-title {
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.32em;
            color: rgba(148, 163, 184, 0.7);
        }

        /* English Panel */
        .english-text {
            font-family: Georgia, 'Times New Roman', serif;
            font-size: 1.125rem;
            line-height: 1.8;
            color: var(--foreground);
            max-width: 42rem;
        }

        .verse {
            margin-bottom: 1rem;
        }

        .verse-number {
            display: inline-block;
            font-size: 0.6875rem;
            font-weight: 600;
            color: rgba(32, 212, 212, 0.8);
            margin-right: 0.5rem;
            vertical-align: super;
            line-height: 1;
            min-width: 1.5rem;
        }

        .verse-text {
            display: inline;
        }

        /* Greek Panel */
        .greek-text {
            font-family: 'GFS Didot', 'Noto Serif', Georgia, serif;
            font-size: 1.375rem;
            line-height: 2.2;
            color: var(--foreground);
            max-width: 42rem;
        }

        .greek-verse {
            margin-bottom: 1.75rem;
        }

        .greek-word {
            display: inline-block;
            padding: 0.125rem 0.25rem;
            margin: 0 0.125rem;
            cursor: pointer;
            border-radius: 0.25rem;
            transition: all 0.15s ease;
            position: relative;
        }

        .greek-word:hover {
            background: rgba(32, 212, 212, 0.15);
            color: var(--primary);
        }

        /* Morphology Tooltip */
        .morph-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(-8px);
            background: rgba(24, 27, 33, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: calc(var(--radius) - 0.125rem);
            padding: 0.875rem 1rem;
            min-width: 220px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
            z-index: 1000;
            backdrop-filter: blur(16px);
        }

        .greek-word:hover .morph-tooltip {
            opacity: 1;
        }

        .morph-lemma {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.625rem;
            font-family: 'GFS Didot', 'Noto Serif', Georgia, serif;
        }

        .morph-detail {
            font-size: 0.75rem;
            color: rgba(148, 163, 184, 0.95);
            line-height: 1.5;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .morph-label {
            display: inline-block;
            background: rgba(32, 212, 212, 0.15);
            color: var(--primary);
            padding: 0.1875rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-right: 0.25rem;
            margin-bottom: 0.375rem;
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            font-size: 0.6875rem;
            color: rgba(148, 163, 184, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.3em;
            font-weight: 600;
        }

        /* Error State */
        .error {
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.25);
            border-radius: calc(var(--radius) - 0.25rem);
            padding: 1rem 1.25rem;
            color: #fca5a5;
            font-size: 0.875rem;
            line-height: 1.5;
        }

        /* Scrollbar */
        .panel {
            scrollbar-width: thin;
            scrollbar-color: rgba(148, 163, 184, 0.45) transparent;
        }

        .panel::-webkit-scrollbar {
            width: 6px;
        }

        .panel::-webkit-scrollbar-track {
            background-color: rgba(148, 163, 184, 0.12);
            border-radius: 9999px;
        }

        .panel::-webkit-scrollbar-thumb {
            background-color: rgba(148, 163, 184, 0.45);
            border-radius: 9999px;
        }

        .panel::-webkit-scrollbar-thumb:hover {
            background-color: rgba(148, 163, 184, 0.65);
        }

        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .panel {
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.08);
                height: auto;
                min-height: 50vh;
            }

            .header {
                padding: 1rem 1.5rem;
            }

            .panel {
                padding: 1.5rem 2rem;
            }

            .english-text,
            .greek-text {
                font-size: 1rem;
            }

            .greek-text {
                font-size: 1.125rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo">Greek Reader</div>

                <div class="reference-picker">
                    <span class="picker-label">Book</span>
                    <select id="bookSelect">
                        <option value="61-Mt-morphgnt.txt">Matthew</option>
                        <option value="62-Mk-morphgnt.txt">Mark</option>
                        <option value="63-Lk-morphgnt.txt">Luke</option>
                        <option value="64-Jn-morphgnt.txt" selected>John</option>
                        <option value="65-Ac-morphgnt.txt">Acts</option>
                        <option value="66-Ro-morphgnt.txt">Romans</option>
                        <option value="67-1Co-morphgnt.txt">1 Corinthians</option>
                        <option value="68-2Co-morphgnt.txt">2 Corinthians</option>
                        <option value="69-Ga-morphgnt.txt">Galatians</option>
                        <option value="70-Eph-morphgnt.txt">Ephesians</option>
                        <option value="71-Php-morphgnt.txt">Philippians</option>
                        <option value="72-Col-morphgnt.txt">Colossians</option>
                        <option value="73-1Th-morphgnt.txt">1 Thessalonians</option>
                        <option value="74-2Th-morphgnt.txt">2 Thessalonians</option>
                        <option value="75-1Ti-morphgnt.txt">1 Timothy</option>
                        <option value="76-2Ti-morphgnt.txt">2 Timothy</option>
                        <option value="77-Tit-morphgnt.txt">Titus</option>
                        <option value="78-Phm-morphgnt.txt">Philemon</option>
                        <option value="79-Heb-morphgnt.txt">Hebrews</option>
                        <option value="80-Jas-morphgnt.txt">James</option>
                        <option value="81-1Pe-morphgnt.txt">1 Peter</option>
                        <option value="82-2Pe-morphgnt.txt">2 Peter</option>
                        <option value="83-1Jn-morphgnt.txt">1 John</option>
                        <option value="84-2Jn-morphgnt.txt">2 John</option>
                        <option value="85-3Jn-morphgnt.txt">3 John</option>
                        <option value="86-Jud-morphgnt.txt">Jude</option>
                        <option value="87-Re-morphgnt.txt">Revelation</option>
                    </select>

                    <span class="picker-label">Chapter</span>
                    <select id="chapterSelect">
                        <option value="1" selected>1</option>
                    </select>
                </div>

                <div class="translation-tabs">
                    <button class="tab-btn active" data-translation="ESV">ESV</button>
                    <button class="tab-btn" data-translation="NIV">NIV</button>
                    <button class="tab-btn" data-translation="NASB">NASB</button>
                    <button class="tab-btn" data-translation="NKJV">NKJV</button>
                </div>
            </div>
        </header>

        <main class="main-grid">
            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">English Translation</h2>
                </div>
                <div id="englishContent" class="english-text">
                    <div class="loading">Loading...</div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <h2 class="panel-title">Greek Text with Morphology</h2>
                </div>
                <div id="greekContent" class="greek-text">
                    <div class="loading">Loading...</div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // State
        let currentBook = '64-Jn-morphgnt.txt';
        let currentChapter = '1';
        let currentTranslation = 'ESV';
        let greekData = null;
        let bibleData = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            loadData();
        });

        function setupEventListeners() {
            document.getElementById('bookSelect').addEventListener('change', (e) => {
                currentBook = e.target.value;
                updateChapterOptions();
                loadData();
            });

            document.getElementById('chapterSelect').addEventListener('change', (e) => {
                currentChapter = e.target.value;
                renderContent();
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentTranslation = e.target.dataset.translation;

                    // Show loading state
                    document.getElementById('englishContent').innerHTML = '<div class="loading">Loading...</div>';

                    // Load new translation
                    await loadBibleTranslation();
                    renderEnglish();
                });
            });
        }

        async function loadData() {
            try {
                // Load Greek text
                const greekResponse = await fetch(currentBook);
                const greekText = await greekResponse.text();
                greekData = parseGreekText(greekText);

                // Load Bible XML for current translation
                await loadBibleTranslation();

                updateChapterOptions();
                renderContent();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('englishContent').innerHTML =
                    '<div class="error">Error loading Bible text. Please make sure the files are in the correct location.</div>';
                document.getElementById('greekContent').innerHTML =
                    '<div class="error">Error loading Greek text. Please make sure the files are in the correct location.</div>';
            }
        }

        async function loadBibleTranslation() {
            try {
                const bibleFile = getBibleFileName(currentTranslation);
                const bookName = getBookNameForTranslation(currentBook);
                const bibleResponse = await fetch(bibleFile);
                const bibleText = await bibleResponse.text();
                bibleData = parseBibleXML(bibleText, bookName);
            } catch (error) {
                console.error('Error loading translation:', error);
                bibleData = {};
            }
        }

        function parseGreekText(text) {
            const lines = text.trim().split('\n');
            const data = {};

            lines.forEach(line => {
                const parts = line.split(/\s+/);
                if (parts.length >= 7) {
                    const ref = parts[0];
                    const chapter = ref.substring(2, 4);
                    const verse = ref.substring(4, 6);
                    const chapterNum = parseInt(chapter, 10);
                    const verseNum = parseInt(verse, 10);

                    if (!data[chapterNum]) data[chapterNum] = {};
                    if (!data[chapterNum][verseNum]) data[chapterNum][verseNum] = [];

                    data[chapterNum][verseNum].push({
                        pos: parts[1],
                        parsing: parts[2],
                        text: parts[3],
                        word: parts[4],
                        normalized: parts[5],
                        lemma: parts[6]
                    });
                }
            });

            return data;
        }

        function parseBibleXML(xmlText, bookName) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            const data = {};

            // Try ESV format first (XMLBIBLE > BIBLEBOOK)
            const esvBooks = xmlDoc.getElementsByTagName('BIBLEBOOK');
            if (esvBooks.length > 0) {
                for (let book of esvBooks) {
                    const chapters = book.getElementsByTagName('CHAPTER');
                    for (let chapter of chapters) {
                        const chapterNum = parseInt(chapter.getAttribute('cnumber'));
                        data[chapterNum] = {};

                        const verses = chapter.getElementsByTagName('VERS');
                        for (let verse of verses) {
                            const verseNum = parseInt(verse.getAttribute('vnumber'));
                            data[chapterNum][verseNum] = verse.textContent.trim();
                        }
                    }
                }
                return data;
            }

            // Try NIV/NASB/NKJV format (bible > b > c > v)
            const books = xmlDoc.getElementsByTagName('b');
            for (let book of books) {
                const bName = book.getAttribute('n');
                if (bName === bookName) {
                    const chapters = book.getElementsByTagName('c');
                    for (let chapter of chapters) {
                        const chapterNum = parseInt(chapter.getAttribute('n'));
                        data[chapterNum] = {};

                        const verses = chapter.getElementsByTagName('v');
                        for (let verse of verses) {
                            const verseNum = parseInt(verse.getAttribute('n'));
                            data[chapterNum][verseNum] = verse.textContent.trim();
                        }
                    }
                    break;
                }
            }

            return data;
        }

        function getBookNameForTranslation(greekFileName) {
            const bookMap = {
                '61-Mt-morphgnt.txt': 'Matthew',
                '62-Mk-morphgnt.txt': 'Mark',
                '63-Lk-morphgnt.txt': 'Luke',
                '64-Jn-morphgnt.txt': 'John',
                '65-Ac-morphgnt.txt': 'Acts',
                '66-Ro-morphgnt.txt': 'Romans',
                '67-1Co-morphgnt.txt': '1 Corinthians',
                '68-2Co-morphgnt.txt': '2 Corinthians',
                '69-Ga-morphgnt.txt': 'Galatians',
                '70-Eph-morphgnt.txt': 'Ephesians',
                '71-Php-morphgnt.txt': 'Philippians',
                '72-Col-morphgnt.txt': 'Colossians',
                '73-1Th-morphgnt.txt': '1 Thessalonians',
                '74-2Th-morphgnt.txt': '2 Thessalonians',
                '75-1Ti-morphgnt.txt': '1 Timothy',
                '76-2Ti-morphgnt.txt': '2 Timothy',
                '77-Tit-morphgnt.txt': 'Titus',
                '78-Phm-morphgnt.txt': 'Philemon',
                '79-Heb-morphgnt.txt': 'Hebrews',
                '80-Jas-morphgnt.txt': 'James',
                '81-1Pe-morphgnt.txt': '1 Peter',
                '82-2Pe-morphgnt.txt': '2 Peter',
                '83-1Jn-morphgnt.txt': '1 John',
                '84-2Jn-morphgnt.txt': '2 John',
                '85-3Jn-morphgnt.txt': '3 John',
                '86-Jud-morphgnt.txt': 'Jude',
                '87-Re-morphgnt.txt': 'Revelation'
            };
            return bookMap[greekFileName] || 'John';
        }

        function updateChapterOptions() {
            if (!greekData) return;

            const chapters = Object.keys(greekData).sort((a, b) => parseInt(a) - parseInt(b));
            const select = document.getElementById('chapterSelect');
            select.innerHTML = chapters.map(ch =>
                `<option value="${ch}" ${ch === currentChapter ? 'selected' : ''}>${ch}</option>`
            ).join('');
        }

        function renderContent() {
            renderEnglish();
            renderGreek();
        }

        function renderEnglish() {
            const container = document.getElementById('englishContent');

            if (!bibleData || !bibleData[parseInt(currentChapter)]) {
                container.innerHTML = '<div class="loading">No translation available</div>';
                return;
            }

            const verses = bibleData[parseInt(currentChapter)];
            const html = Object.keys(verses)
                .sort((a, b) => parseInt(a) - parseInt(b))
                .map(verseNum => `
                    <div class="verse">
                        <span class="verse-number">${verseNum}</span>
                        <span class="verse-text">${verses[verseNum]}</span>
                    </div>
                `).join('');

            container.innerHTML = html;
        }

        function renderGreek() {
            const container = document.getElementById('greekContent');

            if (!greekData || !greekData[parseInt(currentChapter)]) {
                container.innerHTML = '<div class="loading">Loading Greek text...</div>';
                return;
            }

            const verses = greekData[parseInt(currentChapter)];
            const html = Object.keys(verses)
                .sort((a, b) => parseInt(a) - parseInt(b))
                .map(verseNum => {
                    const words = verses[verseNum];
                    const wordsHtml = words.map(word => {
                        const morphInfo = getMorphologyInfo(word);
                        return `
                            <span class="greek-word">
                                ${word.text}
                                <div class="morph-tooltip">
                                    <div class="morph-lemma">${word.lemma}</div>
                                    <div class="morph-detail">${morphInfo}</div>
                                </div>
                            </span>
                        `;
                    }).join(' ');

                    return `
                        <div class="greek-verse">
                            <span class="verse-number">${verseNum}</span>
                            ${wordsHtml}
                        </div>
                    `;
                }).join('');

            container.innerHTML = html;
        }

        function getMorphologyInfo(word) {
            const posMap = {
                'A-': 'Adjective',
                'C-': 'Conjunction',
                'D-': 'Adverb',
                'I-': 'Interjection',
                'N-': 'Noun',
                'P-': 'Preposition',
                'RA': 'Article',
                'RD': 'Demonstrative Pronoun',
                'RI': 'Interrogative Pronoun',
                'RP': 'Personal Pronoun',
                'RR': 'Relative Pronoun',
                'V-': 'Verb',
                'X-': 'Particle'
            };

            const labels = [];
            const pos = posMap[word.pos] || word.pos;
            labels.push(pos);

            // Parse the parsing code
            const parsing = word.parsing;
            if (parsing && parsing.length > 0 && parsing !== '--------') {
                const details = [];

                // Person
                if (parsing[0] !== '-') details.push(getPerson(parsing[0]));
                // Tense
                if (parsing[1] !== '-') details.push(getTense(parsing[1]));
                // Voice
                if (parsing[2] !== '-') details.push(getVoice(parsing[2]));
                // Mood
                if (parsing[3] !== '-') details.push(getMood(parsing[3]));
                // Case
                if (parsing[4] !== '-') details.push(getCase(parsing[4]));
                // Number
                if (parsing[5] !== '-') details.push(getNumber(parsing[5]));
                // Gender
                if (parsing[6] !== '-') details.push(getGender(parsing[6]));
                // Degree
                if (parsing[7] !== '-') details.push(getDegree(parsing[7]));

                if (details.length > 0) {
                    return `<span class="morph-label">${pos}</span><br>${details.join(', ')}`;
                }
            }

            return `<span class="morph-label">${pos}</span>`;
        }

        function getPerson(code) {
            const map = { '1': '1st Person', '2': '2nd Person', '3': '3rd Person' };
            return map[code] || code;
        }

        function getTense(code) {
            const map = {
                'P': 'Present',
                'I': 'Imperfect',
                'F': 'Future',
                'A': 'Aorist',
                'X': 'Perfect',
                'Y': 'Pluperfect'
            };
            return map[code] || code;
        }

        function getVoice(code) {
            const map = { 'A': 'Active', 'M': 'Middle', 'P': 'Passive' };
            return map[code] || code;
        }

        function getMood(code) {
            const map = {
                'I': 'Indicative',
                'D': 'Imperative',
                'S': 'Subjunctive',
                'O': 'Optative',
                'N': 'Infinitive',
                'P': 'Participle'
            };
            return map[code] || code;
        }

        function getCase(code) {
            const map = {
                'N': 'Nominative',
                'G': 'Genitive',
                'D': 'Dative',
                'A': 'Accusative'
            };
            return map[code] || code;
        }

        function getNumber(code) {
            const map = { 'S': 'Singular', 'P': 'Plural' };
            return map[code] || code;
        }

        function getGender(code) {
            const map = { 'M': 'Masculine', 'F': 'Feminine', 'N': 'Neuter' };
            return map[code] || code;
        }

        function getDegree(code) {
            const map = { 'C': 'Comparative', 'S': 'Superlative' };
            return map[code] || code;
        }

        function getBibleFileName(translation) {
            const map = {
                'ESV': 'esv.xml',
                'NIV': 'NIV.xml',
                'NASB': 'Bible_English_NASB_Strong.xml',
                'NKJV': 'Bible_English_NKJV.xml'
            };
            return map[translation] || 'esv.xml';
        }
    </script>
</body>
</html>
